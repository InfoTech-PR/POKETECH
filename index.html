<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pokémon GBA RPG - Canvas Immersive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Axios é necessário para a PokeAPI (config_utils.js) -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    
    <!-- NOVO: CDN de Ícones Font Awesome para o Drag and Drop Handle -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <link rel="manifest" href="/manifest.json" />
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <!-- DragDropTouch para compatibilidade com touch, usado em renderer.js e game_logic.js -->
    <script src="https://cdn.jsdelivr.net/npm/drag-drop-touch@1.3.1/DragDropTouch.js"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap");

      /* Estilo inspirado no GBA */
      .gba-font {
        font-family: "Press Start 2P", cursive;
        text-transform: uppercase;
      }

      .gba-button {
        /* AJUSTES PARA PADRONIZAR O TAMANHO DO TEXTO */
        padding: 8px 12px; /* Diminui o padding */
        font-size: 10px; /* Padroniza o tamanho da fonte para 10px em todos os botões */
        font-weight: bold;
        color: #ffffff;
        border: 3px solid #000;
        border-radius: 8px;
        text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5);
        transition: background-color 0.1s;
        box-shadow: inset 0 -3px 0 rgba(0, 0, 0, 0.3);
        width: 100%;
        height: 40px; /* Mantém a altura */
        line-height: 20px; /* Ajusta a altura da linha */
      }

      .gba-button:hover:not(:disabled) {
        filter: brightness(1.1);
        box-shadow: inset 0 -4px 0 rgba(0, 0, 0, 0.5);
      }

      .gba-button:disabled {
        background-color: #6b7280;
        cursor: not-allowed;
      }

      .gba-screen {
        /* Garante que o card ocupe 100% do seu container pai (max-w-lg) */
        background-color: #c6c6c6;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5),
          0 10px 20px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        height: 100%; /* Ajuste principal para ocupar a altura do container pai */
      }

      /* Esta classe já estava definida e é a chave para a rolagem interna */
      .pokemon-list-container {
        flex-grow: 1; /* Permite que o container da lista cresça e preencha o espaço */
        overflow-y: auto; /* Adiciona scrollbar se necessário */
      }

      /* Animação de balanço da pokébola */
      @keyframes shake {
        0%,
        100% {
          transform: scale(1.5) rotate(0deg);
        }
        20%,
        60% {
          transform: scale(1.5) rotate(-15deg);
        }
        40%,
        80% {
          transform: scale(1.5) rotate(15deg);
        }
      }

      .animate-spin-slow {
        animation: shake 1.2s infinite ease-in-out;
      }
      /* Estilos específicos para o container principal */
      body {
        background-color: #2d3748; /* Fundo escuro */
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 10px;
      }
      
      /* Garante que os containers internos também ocupem a altura total */
      #app-container {
        /* Permite que a largura se ajuste de forma flexível até o limite do wrapper */
        width: 100%; 
        height: 100vh; /* Ocupa a altura total da viewport */
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      /* O wrapper do card GBA deve ocupar a altura total dentro do #app-container */
      .gba-card-wrapper {
        /* Mantém largura flexível, a largura máxima é definida via Tailwind na tag <div> abaixo */
        width: 100%;
        height: 100%; /* Ocupa a altura total do #app-container */
        padding: 1rem;
        margin: auto;
      }
    </style>
  </head>
  <body>
    <!-- NOVIDADE: Adicionado lg:max-w-2xl para limitar o tamanho em telas grandes (PCs) -->
    <div id="app-container" class="lg:max-w-3xl"> 
      <div class="gba-card-wrapper">
        <div
          class="bg-gray-100 border-4 border-gray-800 rounded-lg shadow-2xl p-8 text-center gba-screen"
        >
          <div class="animate-pulse text-xl font-bold text-gray-800 gba-font">
            CARREGANDO...
          </div>
          <div class="mt-4 text-sm text-gray-600 gba-font">
            Inicializando Firebase e LocalStorage.
          </div>
        </div>
      </div>
    </div>

    <!-- Modals (Mantidos aqui para simplificar) -->
    <div
      id="infoModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center z-50"
    >
      <div
        class="bg-green-200 border-4 border-green-800 rounded-lg shadow-2xl p-6 w-full max-w-sm text-center max-h-[90vh] overflow-y-auto"
      >
        <div class="text-lg font-bold text-green-800 gba-font mb-4">
          INFORMAÇÃO
        </div>
        <p class="modal-message text-sm gba-font text-green-700">
          Ação concluída.
        </p>
        <button
          onclick="window.Utils.hideModal('infoModal')"
          class="gba-button bg-green-500 hover:bg-green-600 mt-4 mx-auto w-1/2"
        >
          OK
        </button>
      </div>
    </div>

    <div
      id="errorModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center z-50"
    >
      <div
        class="bg-red-200 border-4 border-red-800 rounded-lg shadow-2xl p-6 w-full max-w-sm text-center max-h-[90vh] overflow-y-auto"
      >
        <div class="text-lg font-bold text-red-800 gba-font mb-4">ERRO!</div>
        <p class="modal-message text-sm gba-font text-red-700">
          Ocorreu um erro no jogo.
        </p>
        <button
          onclick="window.Utils.hideModal('errorModal')"
          class="gba-button bg-red-500 hover:bg-red-600 mt-4 mx-auto w-1/2"
        >
          OK
        </button>
      </div>
    </div>

    <div
      id="pokemonStatsModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center z-50"
    >
      <div
        class="bg-gray-100 border-4 border-gray-800 rounded-lg shadow-2xl p-6 w-full max-w-sm text-center max-h-[90vh] overflow-y-auto"
      >
        <div class="modal-body"></div>
      </div>
    </div>

    <div
      id="pvpModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center z-50"
    >
      <div
        class="bg-gray-100 border-4 border-gray-800 rounded-lg shadow-2xl p-6 w-full max-w-sm text-center max-h-[90vh] overflow-y-auto"
      >
        <div class="text-lg font-bold text-gray-800 gba-font mb-4">
          FIM DE BATALHA
        </div>
        <p class="modal-message text-sm gba-font">Batalha PvP terminada.</p>
        <button
          onclick="window.Utils.hideModal('pvpModal')"
          class="gba-button bg-blue-500 hover:bg-blue-600 mt-4 mx-auto w-1/2"
        >
          OK
        </button>
      </div>
    </div>

    <!-- SCRIPT PRINCIPAL E INICIALIZAÇÃO FIREBASE -->
    <script type="module">
        // Variáveis do Ambiente (Passadas para o escopo global)
        window.appId = typeof __app_id !== "undefined" ? __app_id : "default-app-id";
        
        // Configuração de Fallback do Firebase (do código original)
        const FALLBACK_FIREBASE_CONFIG = { 
            apiKey: "AIzaSyC0Ao4MjuCmDtzIYpi1puIkel73yQFo6Is", 
            authDomain: "pokemon-pvp.firebaseapp.com", 
            projectId: "pokemon-pvp" 
        };

        // Verifica se a variável global de configuração do Firebase existe e não está vazia.
        const providedFirebaseConfig = typeof __firebase_config !== "undefined" && __firebase_config;
        
        // Se a configuração for fornecida pelo ambiente, usa-a. Caso contrário, usa o fallback.
        window.firebaseConfig = providedFirebaseConfig
                                ? JSON.parse(__firebase_config) 
                                : FALLBACK_FIREBASE_CONFIG; 

        window.initialAuthToken = typeof __initial_auth_token !== "undefined" ? __initial_auth_token : null;

        // Instâncias Firebase (Serão preenchidas no js/app.js)
        window.db = null;
        window.auth = null;
        window.userId = "loading...";
        window.gameState = {}; 
        window.unsubscribePvp = null; 

        // --- NOVO: Importação Dinâmica com Cache-Busting ---
        // Um timestamp dinâmico é adicionado ao caminho do arquivo para forçar o navegador
        // a baixar a versão mais recente em vez de usar o cache.
        const cacheBuster = Date.now();
        const appModulePath = `./js/app.js?v=${cacheBuster}`;

        window.onload = async () => {
            try {
                // Importação dinâmica: isso garante que o app.js e todos os seus módulos dependentes 
                // (config_utils.js, battle_core.js, etc.) sejam recarregados.
                const { AuthSetup } = await import(appModulePath);
                
                // Inicia a autenticação/jogo
                AuthSetup.initAuth();
            } catch (error) {
                console.error("Falha ao carregar o módulo principal (app.js):", error);
                const gbaScreen = document.querySelector(".gba-screen");
                if (gbaScreen) {
                    gbaScreen.innerHTML = '<div class="text-xl font-bold text-red-600 gba-font">ERRO DE CARREGAMENTO</div><div class="mt-4 text-sm text-gray-600 gba-font">Verifique o console para detalhes.</div>';
                }
            }
        };

    </script>
  </body>
</html>
